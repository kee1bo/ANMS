<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANMS - Backend Performance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            color: #333;
            font-weight: bold;
        }
        
        .success {
            color: #28a745;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .error {
            color: #dc3545;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .performance-chart {
            height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            margin: 0 2px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }
        
        .status-offline {
            background: #dc3545;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
        }
        
        .features-list li {
            padding: 8px 0;
            color: #666;
            position: relative;
            padding-left: 25px;
        }
        
        .features-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ ANMS Performance Dashboard</h1>
            <p>Backend Performance & Database Optimization Demo</p>
        </div>
        
        <div class="dashboard">
            <!-- Cache Performance Card -->
            <div class="card">
                <h3>üóÑÔ∏è Cache Performance</h3>
                <div id="cache-metrics">
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span class="metric-value" id="cache-status">
                            <span class="status-indicator status-online"></span>Loading...
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Memory Cache Size</span>
                        <span class="metric-value" id="memory-cache-size">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Redis Connected</span>
                        <span class="metric-value" id="redis-status">-</span>
                    </div>
                </div>
                <button class="btn" onclick="testCachePerformance()">Test Cache Speed</button>
                <button class="btn" onclick="refreshCacheStats()">Refresh Stats</button>
            </div>
            
            <!-- System Performance Card -->
            <div class="card">
                <h3>‚ö° System Performance</h3>
                <div id="system-metrics">
                    <div class="metric">
                        <span class="metric-label">Memory Usage</span>
                        <span class="metric-value" id="memory-usage">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Peak Memory</span>
                        <span class="metric-value" id="peak-memory">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">PHP Version</span>
                        <span class="metric-value" id="php-version">-</span>
                    </div>
                </div>
                <button class="btn" onclick="runPerformanceTest()">Run Load Test</button>
                <button class="btn" onclick="refreshSystemInfo()">Refresh Info</button>
            </div>
            
            <!-- Load Testing Card -->
            <div class="card">
                <h3>üî• Load Testing</h3>
                <div id="load-test-results">
                    <div class="metric">
                        <span class="metric-label">Operations</span>
                        <span class="metric-value" id="operations-count">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Time</span>
                        <span class="metric-value" id="total-time">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Ops/Second</span>
                        <span class="metric-value" id="ops-per-second">-</span>
                    </div>
                </div>
                <div class="performance-chart" id="performance-chart">
                    <p>Run a load test to see performance visualization</p>
                </div>
            </div>
            
            <!-- Features Card -->
            <div class="card">
                <h3>üéØ Optimization Features</h3>
                <ul class="features-list">
                    <li>Multi-tier caching system</li>
                    <li>Database connection pooling</li>
                    <li>Query optimization & monitoring</li>
                    <li>Performance monitoring</li>
                    <li>Automatic backup procedures</li>
                    <li>File-based cache fallback</li>
                    <li>Memory usage optimization</li>
                    <li>Load balancing ready</li>
                </ul>
                <button class="btn" onclick="showDemo()">View Demo Data</button>
            </div>
        </div>
        
        <!-- Demo Results -->
        <div class="card" id="demo-results" style="display: none;">
            <h3>üìä Demo Results</h3>
            <pre id="demo-output" style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"></pre>
        </div>
    </div>

    <script>
        // API base URL
        const API_BASE = 'performance-demo.php';
        
        // Utility function to make API calls
        async function apiCall(action, params = {}) {
            const url = new URL(API_BASE, window.location.origin + window.location.pathname);
            url.searchParams.set('action', action);
            
            Object.keys(params).forEach(key => {
                url.searchParams.set(key, params[key]);
            });
            
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                return { status: 'error', message: error.message };
            }
        }
        
        // Update cache statistics
        async function refreshCacheStats() {
            const data = await apiCall('cache_stats');
            
            if (data.status === 'success') {
                const stats = data.cache_stats;
                document.getElementById('cache-status').innerHTML = 
                    `<span class="status-indicator status-online"></span>Active`;
                document.getElementById('memory-cache-size').textContent = stats.memory_cache_size;
                document.getElementById('redis-status').textContent = 
                    stats.redis_connected ? 'Connected' : 'File Cache Only';
            }
        }
        
        // Update system information
        async function refreshSystemInfo() {
            const [memoryData, systemData] = await Promise.all([
                apiCall('memory_usage'),
                apiCall('system_info')
            ]);
            
            if (memoryData.status === 'success') {
                document.getElementById('memory-usage').textContent = memoryData.memory.current;
                document.getElementById('peak-memory').textContent = memoryData.memory.peak;
            }
            
            if (systemData.status === 'success') {
                document.getElementById('php-version').textContent = systemData.system.php_version;
            }
        }
        
        // Test cache performance
        async function testCachePerformance() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Testing...';
            
            // First call (should be slow)
            const start1 = performance.now();
            const result1 = await apiCall('cache_test', { id: Math.random() });
            const time1 = performance.now() - start1;
            
            // Second call (should be fast - cached)
            const start2 = performance.now();
            const result2 = await apiCall('cache_test', { id: 'same' });
            const time2 = performance.now() - start2;
            
            // Third call (should be very fast - cached)
            const start3 = performance.now();
            const result3 = await apiCall('cache_test', { id: 'same' });
            const time3 = performance.now() - start3;
            
            const improvement = ((time1 - time3) / time1 * 100).toFixed(1);
            
            alert(`Cache Performance Test Results:
            
First call (uncached): ${time1.toFixed(2)}ms
Second call (cached): ${time2.toFixed(2)}ms  
Third call (cached): ${time3.toFixed(2)}ms

Performance improvement: ${improvement}%`);
            
            btn.disabled = false;
            btn.textContent = 'Test Cache Speed';
        }
        
        // Run performance test
        async function runPerformanceTest() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Running Test...';
            
            const operations = 100;
            const data = await apiCall('performance_test', { operations });
            
            if (data.status === 'success') {
                document.getElementById('operations-count').textContent = data.operations;
                document.getElementById('total-time').textContent = data.total_time + 's';
                document.getElementById('ops-per-second').textContent = data.ops_per_second;
                
                // Create simple performance visualization
                createPerformanceChart(data.ops_per_second);
            }
            
            btn.disabled = false;
            btn.textContent = 'Run Load Test';
        }
        
        // Create performance chart
        function createPerformanceChart(opsPerSecond) {
            const chart = document.getElementById('performance-chart');
            chart.innerHTML = '';
            
            const maxOps = Math.max(opsPerSecond, 1000);
            const barCount = 20;
            
            for (let i = 0; i < barCount; i++) {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = Math.random() * 80 + 20; // Random height for demo
                bar.style.height = height + '%';
                bar.style.width = `${100 / barCount - 1}%`;
                chart.appendChild(bar);
            }
            
            // Add performance label
            const label = document.createElement('div');
            label.style.position = 'absolute';
            label.style.top = '10px';
            label.style.right = '10px';
            label.style.background = 'rgba(255,255,255,0.9)';
            label.style.padding = '5px 10px';
            label.style.borderRadius = '4px';
            label.style.fontSize = '14px';
            label.style.fontWeight = 'bold';
            label.textContent = `${opsPerSecond} ops/sec`;
            chart.appendChild(label);
        }
        
        // Show demo data
        async function showDemo() {
            const data = await apiCall('demo');
            const resultsDiv = document.getElementById('demo-results');
            const outputPre = document.getElementById('demo-output');
            
            outputPre.textContent = JSON.stringify(data, null, 2);
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize dashboard
        async function initDashboard() {
            await Promise.all([
                refreshCacheStats(),
                refreshSystemInfo()
            ]);
        }
        
        // Auto-refresh every 30 seconds
        setInterval(initDashboard, 30000);
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>